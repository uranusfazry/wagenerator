<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  <title>WhatsApp Pro Creator</title>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      /* UPDATE: Warna background dibuat jauh lebih gelap sesuai gambar */
      --bg: #04070a; 
      --card: #0b1216;
      --muted: #8696a0;
      --text-main: #e9edef;
      --accent: #00a884; 
      --modal-bg: #1f2c34; 
      --danger: #ef4444;
      --badge-bg: #25d366; 
      font-family: 'Inter', system-ui, sans-serif;
    }
    *{box-sizing:border-box; -webkit-tap-highlight-color: transparent;}
    
    body{
      margin:0;
      /* UPDATE: Gradient disesuaikan ke warna yang lebih pekat/gelap */
      background: linear-gradient(180deg, var(--bg), #020305);
      color:var(--text-main);
      user-select: none; 
      -webkit-user-select: none;
      padding-bottom: 100px;
      overflow-x: hidden;
    }

    /* --- UTILS --- */
    .locked-image {
      width: 100%; display: block;
      pointer-events: none; user-select: none; -webkit-user-drag: none;
    }
    
    /* --- LIST --- */
    .list{padding:0 0 120px 0}
    
    .item{
      display:flex; align-items:center; gap:14px;
      padding:12px 16px;
      cursor: pointer;
      transition: background 0.2s;
      position: relative;
    }
    .item:active{background:rgba(255,255,255,0.03)}
    
    .avatar{
      width:50px;height:50px;border-radius:50%;flex:0 0 50px;overflow:hidden;
      background:#636e72; /* Default fallback */
      display:flex;align-items:center;justify-content:center;
      font-weight:600; font-size: 20px; color: #fff;
      transition: background 0.3s ease;
    }
    .avatar img { width: 100%; height: 100%; object-fit: cover; }

    .meta{
      flex:1; min-width:0;
      /* border-bottom dihapus agar tidak ada garis */
      padding-bottom: 14px;
      display: flex; flex-direction: column; justify-content: center;
    }
    
    .top-row { display: flex; justify-content: space-between; align-items: baseline; margin-bottom: 4px; }
    
    .name{font-weight:500; font-size: 17px; color: var(--text-main);}
    .time{color:var(--muted); font-size:12px;}
    
    .bot-row { display: flex; justify-content: space-between; align-items: center; }
    
    .preview{
      color:var(--muted); font-size:14px;
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
      max-width: 85%;
    }
    
    .badge{
      min-width:20px; height:20px; border-radius:10px;
      background:var(--badge-bg); 
      display:inline-flex; align-items:center; justify-content:center;
      font-weight:700; color:#000; padding:0 6px; 
      font-size: 11px; line-height: 1;
    }

    /* --- FAB --- */
    .fab{
      position:fixed; right: -20px; bottom:88px;
      width:146px; height:146px;
      background: transparent;
      display:flex; align-items:center; justify-content:center;
      cursor: pointer; z-index: 10;
      transition: transform 0.15s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }
    .fab:active { transform: scale(0.92); }
    .fab img { pointer-events: none; user-select: none; -webkit-user-drag: none; }

    .topbar, .bottom { position:fixed; left:0; right:0; z-index: 5; }
    .topbar { top:0; background: var(--bg); }
    .bottom { bottom:0; background: linear-gradient(180deg,rgba(0,0,0,0.1),rgba(0,0,0,0.3)); pointer-events: none; }
    .bottom img { pointer-events: none; }
    
    /* UPDATE: Tinggi spacer dinaikkan lagi jadi 170px */
    .spacer-top { height: 170px; } 

    /* --- MODAL SYSTEM --- */
    .modal-overlay {
      position: fixed; top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.6);
      display: flex; align-items: flex-end; 
      justify-content: center;
      z-index: 100;
      opacity: 0; pointer-events: none;
      transition: opacity 0.3s ease;
      backdrop-filter: blur(2px);
    }
    .modal-overlay.open { opacity: 1; pointer-events: auto; }
    
    .modal-container {
      background: var(--modal-bg);
      width: 100%; max-width: 400px;
      border-radius: 20px 20px 0 0; 
      padding: 24px 24px 40px 24px;
      box-shadow: 0 -4px 20px rgba(0,0,0,0.4);
      transform: translateY(100%);
      transition: transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
    }
    @media(min-width: 450px) {
        .modal-overlay { align-items: center; }
        .modal-container { border-radius: 24px; transform: scale(0.9); opacity: 0; }
    }
    
    .modal-overlay.open .modal-container {
      transform: translateY(0);
      opacity: 1;
    }
    @media(min-width: 450px) {
        .modal-overlay.open .modal-container { transform: scale(1); }
    }

    .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
    .modal-title { font-size: 20px; font-weight: 600; color: var(--text-main); }
    .btn-close-icon { background:none; border:none; color:var(--muted); font-size:24px; cursor:pointer; }

    .form-group { margin-bottom: 16px; }
    .form-label { display: block; font-size: 13px; color: var(--accent); margin-bottom: 6px; font-weight: 500; }
    
    .form-input {
      width: 100%; padding: 12px 14px;
      background: #2a3942; 
      border: 1px solid transparent;
      border-radius: 10px; color: #fff; font-size: 15px;
      font-family: inherit; outline: none;
      transition: border-color 0.2s;
    }
    .form-input:focus { border-color: var(--accent); }

    .row { display: flex; gap: 12px; }
    
    /* Avatar Selector */
    .avatar-selector {
      display: flex; gap: 12px; align-items: center;
      background: #2a3942; padding: 10px; border-radius: 12px;
    }
    .avatar-preview-small {
      width: 40px; height: 40px; border-radius: 50%; background: #636e72;
      overflow: hidden; display: flex; align-items: center; justify-content: center;
      font-weight: bold; color: #fff; flex-shrink: 0;
    }
    .file-btn {
      font-size: 13px; color: var(--accent); font-weight: 600;
      cursor: pointer; padding: 4px 8px;
    }

    /* Action Buttons */
    .modal-actions { display: flex; gap: 12px; margin-top: 24px; }
    .btn {
      flex: 1; padding: 14px; border: none; border-radius: 50px;
      font-weight: 600; font-size: 15px; cursor: pointer;
      display: flex; align-items: center; justify-content: center;
      transition: filter 0.2s;
    }
    .btn:active { filter: brightness(0.8); }
    .btn-primary { background: var(--accent); color: #111b21; }
    .btn-danger { background: transparent; color: var(--danger); border: 1px solid rgba(239,68,68,0.3); }
    .btn-danger:active { background: rgba(239,68,68,0.1); }

    /* --- CONFIRMATION POPUP (Custom) --- */
    .confirm-overlay {
      position: fixed; top:0; left:0; width:100%; height:100%;
      background: rgba(0,0,0,0.7); z-index: 200;
      display: flex; align-items: center; justify-content: center;
      opacity: 0; pointer-events: none; transition: opacity 0.2s;
    }
    .confirm-overlay.show { opacity: 1; pointer-events: auto; }

    .confirm-box {
      background: #2a3942; width: 85%; max-width: 320px;
      border-radius: 18px; padding: 24px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.5);
      transform: scale(0.9); transition: transform 0.2s;
    }
    .confirm-overlay.show .confirm-box { transform: scale(1); }

    .confirm-text { color: #d1d7db; font-size: 16px; margin-bottom: 24px; line-height: 1.5; }
    .confirm-buttons { display: flex; justify-content: flex-end; gap: 20px; }
    .c-btn { background: none; border: none; font-weight: 600; font-size: 14px; cursor: pointer; padding: 8px 12px; border-radius: 4px;}
    .c-btn-cancel { color: var(--accent); }
    .c-btn-ok { color: var(--accent); } 
    .c-btn:active { background: rgba(255,255,255,0.05); }

    /* --- TOAST NOTIFICATION --- */
    .toast {
      position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%) translateY(20px);
      background: #333; color: white; padding: 12px 24px;
      border-radius: 50px; font-size: 14px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      opacity: 0; transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      z-index: 300; pointer-events: none; white-space: nowrap;
    }
    .toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }

  </style>
</head>
<body>

  <div class="topbar">
    <img src="https://i.imghippo.com/files/wC5348bFU.jpg" draggable="false" class="locked-image" alt="Top Bar" />
  </div>
  <div class="spacer-top"></div>

  <div class="list" id="chatList"></div>

  <div class="fab" title="Buat Chat Baru" onclick="openEditor()">
    <img src="https://i.imghippo.com/files/rcIF1146eCY.png" draggable="false" alt="New Chat" style="width:100%; height:100%; object-fit:contain; filter: drop-shadow(0 10px 20px rgba(0,0,0,0.5));">
  </div>

  <div class="bottom">
    <img src="https://i.imghippo.com/files/JV5005ev.jpg" draggable="false" class="locked-image" alt="Bottom Bar" />
  </div>

  <!-- EDITOR MODAL --><div class="modal-overlay" id="editorModal">
    <div class="modal-container">
      <div class="modal-header">
        <div class="modal-title" id="modalTitle">Edit Chat</div>
        <button class="btn-close-icon" onclick="closeEditor()">&times;</button>
      </div>
      
      <div class="form-group">
        <label class="form-label">Nama Kontak</label>
        <input type="text" class="form-input" id="inpName" placeholder="Nama...">
      </div>
      
      <div class="form-group">
        <label class="form-label">Pesan Terakhir</label>
        <input type="text" class="form-input" id="inpMsg" placeholder="Pesan...">
      </div>

      <div class="row">
        <div class="form-group" style="flex:1">
          <label class="form-label">Waktu</label>
          <input type="text" class="form-input" id="inpTime" placeholder="12:00">
        </div>
        <div class="form-group" style="width:80px">
          <label class="form-label">Unread</label>
          <input type="number" class="form-input" id="inpUnread" value="0">
        </div>
      </div>

      <div class="form-group">
        <label class="form-label">Foto Profil</label>
        <div class="avatar-selector">
            <div class="avatar-preview-small" id="avatarPrev">A</div>
            <div style="flex:1">
                <input type="text" class="form-input" id="inpAvatarText" placeholder="Ketik Inisial" style="margin-bottom:6px; font-size:13px; padding:8px;">
                <label class="file-btn">
                    + Upload Foto
                    <input type="file" id="inpAvatarFile" accept="image/*" style="display:none">
                </label>
            </div>
        </div>
        <input type="hidden" id="currentImageBase64">
      </div>

      <div class="modal-actions">
        <button class="btn btn-danger" id="btnDelete" onclick="tryDelete()">Hapus</button>
        <button class="btn btn-primary" onclick="saveChat()">Simpan</button>
      </div>
    </div>
  </div>

  <!-- CUSTOM CONFIRM MODAL --><div class="confirm-overlay" id="confirmModal">
    <div class="confirm-box">
      <div class="confirm-text" id="confirmText">Hapus chat ini?</div>
      <div class="confirm-buttons">
        <button class="c-btn c-btn-cancel" onclick="closeConfirm()">Batal</button>
        <button class="c-btn c-btn-ok" id="confirmOkBtn">Hapus</button>
      </div>
    </div>
  </div>

  <!-- TOAST NOTIFICATION --><div class="toast" id="toast">Notifikasi</div>

  <script>
    /* --- PALET WARNA AVATAR --- */
    const avatarColors = [
        '#00A884', // WA Teal
        '#FF5252', // Red
        '#FF9800', // Orange
        '#3F51B5', // Indigo
        '#2196F3', // Blue
        '#9C27B0', // Purple
        '#00BCD4', // Cyan
        '#4CAF50', // Green
        '#795548', // Brown
        '#607D8B', // Blue Grey
        '#E91E63'  // Pink
    ];

    function getRandomColor() {
        return avatarColors[Math.floor(Math.random() * avatarColors.length)];
    }

    /* --- DATA --- */
    // Menambahkan properti 'color' ke setiap objek chat
    let chats = [
      {name:'Zahra', msg:'Ardi temenin aku dong di kost', time:'20.41', unread:13, avatar:'Z', isImage: false, color: getRandomColor()},
      {name:'Putri', msg:'Ardi ketemu yuk kita jalan bareng', time:'20.41', unread:1, avatar:'P', isImage: false, color: getRandomColor()},
      {name:'Nabila', msg:'Ardi Call yuk kangen banget', time:'20.25', unread:1, avatar:'N', isImage: false, color: getRandomColor()},
    ];
    let editIdx = -1;
    let tempDraftColor = ''; // Untuk menyimpan warna saat mode edit/create

    /* --- ELEMENTS --- */
    const listEl = document.getElementById('chatList');
    
    // Editor
    const modal = document.getElementById('editorModal');
    const modalTitle = document.getElementById('modalTitle');
    const inpName = document.getElementById('inpName');
    const inpMsg = document.getElementById('inpMsg');
    const inpTime = document.getElementById('inpTime');
    const inpUnread = document.getElementById('inpUnread');
    const inpAvatarText = document.getElementById('inpAvatarText');
    const inpAvatarFile = document.getElementById('inpAvatarFile');
    const avatarPrev = document.getElementById('avatarPrev');
    const hiddenBase64 = document.getElementById('currentImageBase64');
    const btnDelete = document.getElementById('btnDelete');

    // Confirm & Toast
    const confirmModal = document.getElementById('confirmModal');
    const confirmOkBtn = document.getElementById('confirmOkBtn');
    const toastEl = document.getElementById('toast');

    /* --- RENDER FUNCTION --- */
    function render() {
      listEl.innerHTML = '';
      chats.forEach((c, idx) => {
        const el = document.createElement('div');
        el.className = 'item';
        el.onclick = () => openEditor(idx);

        let avatarContent = c.avatar;
        // Jika belum ada warna (data lama), assign random
        if(!c.color) c.color = getRandomColor();

        if(c.isImage) {
            avatarContent = `<img src="${c.avatar}" alt="img">`;
        }

        // Menambahkan inline style untuk background-color
        el.innerHTML = `
          <div class="avatar" style="background-color: ${c.color}">
            ${avatarContent}
          </div>
          <div class="meta">
            <div class="top-row">
                <div class="name">${c.name}</div>
                <div class="time">${c.time}</div>
            </div>
            <div class="bot-row">
                <div class="preview">${c.msg || ''}</div>
                ${c.unread > 0 ? `<div class="badge">${c.unread}</div>` : ''}
            </div>
          </div>
        `;
        listEl.appendChild(el);
      });
    }

    /* --- EDITOR LOGIC --- */
    function openEditor(idx = -1) {
      editIdx = idx;
      // Reset Inputs
      inpAvatarFile.value = '';
      
      if(idx === -1) {
        // NEW CHAT
        modalTitle.innerText = "Chat Baru";
        inpName.value = "";
        inpMsg.value = "";
        inpTime.value = "Now";
        inpUnread.value = 1;
        inpAvatarText.value = "";
        hiddenBase64.value = "";
        btnDelete.style.display = "none";
        
        // Generate Random Color untuk Draft Baru
        tempDraftColor = getRandomColor();
        updateAvatarPreview('?', false, tempDraftColor);

      } else {
        // EDIT CHAT
        const c = chats[idx];
        modalTitle.innerText = "Edit Chat";
        inpName.value = c.name;
        inpMsg.value = c.msg;
        inpTime.value = c.time;
        inpUnread.value = c.unread;
        btnDelete.style.display = "block";
        
        // Pakai warna yang sudah ada
        tempDraftColor = c.color;

        if(c.isImage) {
            hiddenBase64.value = c.avatar;
            inpAvatarText.value = "";
            updateAvatarPreview(c.avatar, true, tempDraftColor);
        } else {
            hiddenBase64.value = "";
            inpAvatarText.value = c.avatar;
            updateAvatarPreview(c.avatar, false, tempDraftColor);
        }
      }
      
      modal.classList.add('open');
    }

    function closeEditor() {
      modal.classList.remove('open');
    }

    /* --- AVATAR HANDLING --- */
    inpAvatarText.addEventListener('input', (e) => {
        if(e.target.value) {
            hiddenBase64.value = ""; // Clear image if typing text
            updateAvatarPreview(e.target.value, false, tempDraftColor);
        }
    });

    inpAvatarFile.addEventListener('change', function() {
        if (this.files && this.files[0]) {
            const reader = new FileReader();
            reader.onload = function (e) {
                hiddenBase64.value = e.target.result; 
                inpAvatarText.value = "";
                updateAvatarPreview(e.target.result, true, tempDraftColor);
            }
            reader.readAsDataURL(this.files[0]);
        }
    });

    function updateAvatarPreview(val, isImg, bgColor) {
        // Set background color preview
        avatarPrev.style.backgroundColor = bgColor;

        if(isImg) {
            avatarPrev.innerHTML = `<img src="${val}" style="width:100%;height:100%;object-fit:cover">`;
        } else {
            avatarPrev.innerHTML = val.substring(0,2).toUpperCase();
        }
    }

    /* --- SAVE & DELETE --- */
    function saveChat() {
        const name = inpName.value || "Tanpa Nama";
        
        let finalAvatar = "A";
        let isImage = false;

        if(hiddenBase64.value) {
            finalAvatar = hiddenBase64.value;
            isImage = true;
        } else {
            finalAvatar = inpAvatarText.value.substring(0,2).toUpperCase() || name.charAt(0).toUpperCase();
        }

        const newObj = {
            name: name,
            msg: inpMsg.value,
            time: inpTime.value,
            unread: parseInt(inpUnread.value) || 0,
            avatar: finalAvatar,
            isImage: isImage,
            color: tempDraftColor // Simpan warna
        };

        if(editIdx === -1) {
            chats.unshift(newObj);
        } else {
            chats[editIdx] = newObj;
        }

        render();
        closeEditor();
        showToast("Chat disimpan");
    }

    function tryDelete() {
        closeEditor();
        setTimeout(() => {
             showConfirm(() => {
                if(editIdx > -1) {
                    chats.splice(editIdx, 1);
                    render();
                    showToast("Chat dihapus");
                }
            });
        }, 200);
    }

    /* --- CUSTOM CONFIRMATION SYSTEM --- */
    let onConfirmAction = null;

    function showConfirm(action) {
        onConfirmAction = action;
        confirmModal.classList.add('show');
    }

    function closeConfirm() {
        confirmModal.classList.remove('show');
        onConfirmAction = null;
    }

    confirmOkBtn.onclick = () => {
        if(onConfirmAction) onConfirmAction();
        closeConfirm();
    }

    /* --- TOAST SYSTEM --- */
    let toastTimeout;
    function showToast(msg) {
        toastEl.innerText = msg;
        toastEl.classList.add('show');
        clearTimeout(toastTimeout);
        toastTimeout = setTimeout(() => {
            toastEl.classList.remove('show');
        }, 3000);
    }

    // INIT
    render();
  </script>

</body>
</html>
