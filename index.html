<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <!-- Meta viewport diatur untuk mobile -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>WhatsApp Pro Creator</title>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <!-- Library untuk Screenshot -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  
  <style>
    :root{
      --bg: #0b141a; 
      --card: #0b1216;
      --muted: #8696a0;
      --text-main: #e9edef;
      --accent: #00a884; 
      --modal-bg: #1f2c34; 
      --danger: #ef4444;
      --badge-bg: #25d366; 
      font-family: 'Inter', system-ui, sans-serif;
      
      /* Variabel untuk lebar maksimal tampilan mobile */
      --mobile-width: 480px; 
    }
    *{box-sizing:border-box; -webkit-tap-highlight-color: transparent;}
    
    /* --- LAYOUT UTAMA DESKTOP & MOBILE --- */
    html {
        background-color: #111; /* Warna luar area HP di desktop */
        min-height: 100vh;
    }

    body {
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center; /* Posisi tengah di desktop */
      min-height: 100vh;
      background-color: #050505;
      color: var(--text-main);
    }

    /* WADAH UTAMA (HP SIMULATOR) */
    #main-app {
      width: 100%;
      max-width: var(--mobile-width);
      background: #0b141a; /* Background asli WA */
      position: relative;
      min-height: 100vh;
      box-shadow: 0 0 50px rgba(0,0,0,0.5);
      overflow: hidden; /* Mencegah scroll bar ganda */
      display: flex;
      flex-direction: column;
    }

    /* --- UTILS --- */
    .locked-image {
      width: 100%; display: block;
      pointer-events: none; user-select: none; -webkit-user-drag: none;
    }
    
    /* --- LIST --- */
    /* List mengisi sisa ruang agar footer terdorong ke bawah jika konten sedikit, 
       tapi tetap bisa discroll jika konten banyak */
    .list {
      flex: 1; 
      padding: 0 0 20px 0;
    }
    
    .item{
      display:flex; align-items:center; gap:14px;
      padding:12px 16px;
      cursor: pointer;
      transition: background 0.2s;
      position: relative;
    }
    .item:active{background:rgba(255,255,255,0.03)}
    
    .avatar{
      width:50px;height:50px;border-radius:50%;flex:0 0 50px;overflow:hidden;
      background:#636e72; 
      display:flex;align-items:center;justify-content:center;
      font-weight:600; font-size: 20px; color: #fff;
      transition: background 0.3s ease;
    }
    .avatar img { width: 100%; height: 100%; object-fit: cover; }

    .meta{
      flex:1; min-width:0;
      padding-bottom: 14px;
      display: flex; flex-direction: column; justify-content: center;
      border-bottom: 1px solid rgba(134, 150, 160, 0.15);
    }
    .item:last-child .meta { border-bottom: none; }
    
    .top-row { display: flex; justify-content: space-between; align-items: baseline; margin-bottom: 4px; }
    
    .name{font-weight:500; font-size: 17px; color: var(--text-main);}
    .time{color:var(--muted); font-size:12px;}
    
    .bot-row { display: flex; justify-content: space-between; align-items: center; }
    
    .preview{
      color:var(--muted); font-size:14px;
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
      max-width: 85%;
    }
    
    .badge{
      min-width:20px; height:20px; border-radius:10px;
      background:var(--badge-bg); 
      display:inline-flex; align-items:center; justify-content:center;
      font-weight:700; color:#000; padding:0 6px; 
      font-size: 11px; line-height: 1;
    }

    /* --- FAB (NEW CHAT) --- */
    .fab{
      position: fixed; 
      bottom: 80px; /* Diatur agar pas diatas navbar */
      width: 130px; height: 130px;
      background: transparent;
      display: flex; align-items: center; justify-content: center;
      cursor: pointer; z-index: 10;
      transition: transform 0.15s;
      
      /* Posisi FAB agar tetap di dalam container HP */
      left: 50%; 
      transform: translateX(-50%) translateX(130px); /* Geser ke kanan */
      margin-left: -65px; /* Koreksi center */
    }
    
    /* Media query untuk memastikan FAB menempel di container pada desktop */
    @media (min-width: 481px) {
       .fab {
         left: 50%;
         margin-left: 0;
         /* Hitung posisi absolut relatif terhadap window center */
         transform: translateX(100px); 
       }
    }

    .fab:active { transform: scale(0.92) translateX(100px); }
    @media (max-width: 480px) {
        .fab:active { transform: scale(0.92) translateX(-50%) translateX(130px); margin-left: -65px;}
    }

    .fab img { pointer-events: none; user-select: none; -webkit-user-drag: none; }

    /* --- FIXED BARS (TOP & BOTTOM) --- */
    .topbar { 
        position: sticky; top: 0; 
        z-index: 20; background: var(--bg);
        width: 100%;
    }
    
    .bottom { 
        position: fixed; bottom: 0;
        z-index: 20; 
        width: 100%;
        max-width: var(--mobile-width);
        background: linear-gradient(180deg,rgba(0,0,0,0.1),rgba(0,0,0,0.3)); 
        pointer-events: none;
    }
    
    /* Spacer agar konten tidak tertutup header */
    /* Karena kita pakai Sticky, spacer top tidak terlalu krusial kecuali untuk visual overlap background */
    .spacer-top { height: 0px; } 
    
    /* Spacer bawah agar konten list terakhir tidak tertutup navbar */
    .spacer-bottom { height: 80px; } 

    /* --- MODAL SYSTEM --- */
    .modal-overlay {
      position: fixed; top: 0; bottom: 0;
      left: 50%; transform: translateX(-50%);
      width: 100%; max-width: var(--mobile-width);
      
      background: rgba(0,0,0,0.6);
      display: flex; align-items: flex-end; 
      justify-content: center;
      z-index: 100;
      opacity: 0; pointer-events: none;
      transition: opacity 0.3s ease;
      backdrop-filter: blur(2px);
    }
    .modal-overlay.open { opacity: 1; pointer-events: auto; }
    
    .modal-container {
      background: var(--modal-bg);
      width: 100%; max-width: 400px;
      border-radius: 20px 20px 0 0; 
      padding: 24px 24px 40px 24px;
      box-shadow: 0 -4px 20px rgba(0,0,0,0.4);
      transform: translateY(100%);
      transition: transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
    }
    .modal-overlay.open .modal-container { transform: translateY(0); opacity: 1; }

    .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
    .modal-title { font-size: 20px; font-weight: 600; color: var(--text-main); }
    .header-actions { display: flex; align-items: center; gap: 12px; }

    .btn-close-icon { background:none; border:none; color:var(--muted); font-size:28px; cursor:pointer; line-height: 1; padding: 4px; }
    
    .btn-header-dl {
      background: rgba(0, 168, 132, 0.15);
      border: none;
      color: var(--accent);
      border-radius: 12px;
      width: 36px; height: 36px;
      display: flex; align-items: center; justify-content: center;
      cursor: pointer;
      transition: background 0.2s;
    }
    .btn-header-dl:active { background: rgba(0, 168, 132, 0.25); }
    .btn-header-dl svg { width: 20px; height: 20px; fill: currentColor; }

    .form-group { margin-bottom: 16px; }
    .form-label { display: block; font-size: 13px; color: var(--accent); margin-bottom: 6px; font-weight: 500; }
    
    .form-input {
      width: 100%; padding: 12px 14px;
      background: #2a3942; 
      border: 1px solid transparent;
      border-radius: 10px; color: #fff; font-size: 15px;
      font-family: inherit; outline: none;
      transition: border-color 0.2s;
    }
    .form-input:focus { border-color: var(--accent); }

    .row { display: flex; gap: 12px; }
    
    .avatar-selector {
      display: flex; gap: 12px; align-items: center;
      background: #2a3942; padding: 10px; border-radius: 12px;
    }
    .avatar-preview-small {
      width: 40px; height: 40px; border-radius: 50%; background: #636e72;
      overflow: hidden; display: flex; align-items: center; justify-content: center;
      font-weight: bold; color: #fff; flex-shrink: 0;
    }
    .file-btn {
      font-size: 13px; color: var(--accent); font-weight: 600;
      cursor: pointer; padding: 4px 8px;
    }

    .modal-actions { display: flex; gap: 12px; margin-top: 24px; }
    .btn {
      flex: 1; padding: 14px; border: none; border-radius: 50px;
      font-weight: 600; font-size: 15px; cursor: pointer;
      display: flex; align-items: center; justify-content: center;
      transition: filter 0.2s;
    }
    .btn:active { filter: brightness(0.8); }
    .btn-primary { background: var(--accent); color: #111b21; }
    .btn-danger { background: transparent; color: var(--danger); border: 1px solid rgba(239,68,68,0.3); }
    .btn-danger:active { background: rgba(239,68,68,0.1); }

    /* --- CONFIRMATION POPUP --- */
    .confirm-overlay {
      position: fixed; top:0; height:100%;
      left: 50%; transform: translateX(-50%);
      width: 100%; max-width: var(--mobile-width);
      background: rgba(0,0,0,0.7); z-index: 200;
      display: flex; align-items: center; justify-content: center;
      opacity: 0; pointer-events: none; transition: opacity 0.2s;
    }
    .confirm-overlay.show { opacity: 1; pointer-events: auto; }

    .confirm-box {
      background: #2a3942; width: 85%; max-width: 320px;
      border-radius: 18px; padding: 24px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.5);
      transform: scale(0.9); transition: transform 0.2s;
    }
    .confirm-overlay.show .confirm-box { transform: scale(1); }

    .confirm-text { color: #d1d7db; font-size: 16px; margin-bottom: 24px; line-height: 1.5; }
    .confirm-buttons { display: flex; justify-content: flex-end; gap: 20px; }
    .c-btn { background: none; border: none; font-weight: 600; font-size: 14px; cursor: pointer; padding: 8px 12px; border-radius: 4px;}
    .c-btn-cancel { color: var(--accent); }
    .c-btn-ok { color: var(--accent); } 
    .c-btn:active { background: rgba(255,255,255,0.05); }

    /* --- TOAST --- */
    .toast {
      position: fixed; bottom: 100px; 
      left: 50%; transform: translateX(-50%) translateY(20px);
      background: #333; color: white; padding: 12px 24px;
      border-radius: 50px; font-size: 14px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      opacity: 0; transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      z-index: 300; pointer-events: none; white-space: nowrap;
    }
    .toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }
    
    /* Loading Overlay */
    .loading-overlay {
        position: fixed; top:0; height:100%;
        left: 50%; transform: translateX(-50%);
        width: 100%; max-width: var(--mobile-width);
        background: rgba(0,0,0,0.8); z-index: 999;
        display: flex; flex-direction: column; align-items: center; justify-content: center;
        color: #00a884; opacity: 0; pointer-events: none; transition: opacity 0.3s;
    }
    .loading-overlay.show { opacity: 1; pointer-events: auto; }
    .spinner {
        width: 40px; height: 40px; border: 4px solid rgba(255,255,255,0.1);
        border-top-color: #00a884; border-radius: 50%;
        animation: spin 1s linear infinite; margin-bottom: 15px;
    }
    @keyframes spin { to {transform: rotate(360deg);} }

    /* --- SCREENSHOT MODE HELPERS --- */
    /* Class ini ditambahkan via JS saat screenshot berlangsung */
    .screenshot-mode .bottom {
        position: absolute !important; 
        bottom: 0 !important;
        left: 0 !important; right: 0 !important;
        transform: none !important;
    }
    .screenshot-mode .fab { display: none !important; }
    .screenshot-mode .topbar { position: relative !important; }
    .screenshot-mode {
        height: auto !important; 
        min-height: auto !important;
        overflow: visible !important;
    }

  </style>
</head>
<body>

  <!-- WRAPPER UTAMA (HP) -->
  <div id="main-app">

      <!-- LOADING SCREENSHOT -->
      <div class="loading-overlay" id="loadingOverlay">
          <div class="spinner"></div>
          <div>Memproses Gambar...</div>
      </div>

      <div class="topbar">
        <img src="https://i.imghippo.com/files/wC5348bFU.jpg" draggable="false" class="locked-image" alt="Top Bar" />
      </div>

      <!-- Spacer top dihapus diganti margin list atau sticky -->
      
      <div class="list" id="chatList"></div>
      
      <div class="spacer-bottom"></div>

      <div class="fab" title="Buat Chat Baru" onclick="openEditor()">
        <img src="https://i.imghippo.com/files/rcIF1146eCY.png" draggable="false" alt="New Chat" style="width:100%; height:100%; object-fit:contain; filter: drop-shadow(0 10px 20px rgba(0,0,0,0.5));">
      </div>

      <div class="bottom">
        <img src="https://i.imghippo.com/files/JV5005ev.jpg" draggable="false" class="locked-image" alt="Bottom Bar" />
      </div>

      <!-- MODAL & DIALOGS tetap di dalam Wrapper agar posisinya akurat -->
      
      <!-- EDITOR MODAL -->
      <div class="modal-overlay" id="editorModal">
        <div class="modal-container">
          <div class="modal-header">
            <div class="modal-title" id="modalTitle">Edit Chat</div>
            <div class="header-actions">
                <button class="btn-header-dl" title="Download Screenshot" onclick="downloadFromModal()">
                    <svg viewBox="0 0 24 24">
                        <path d="M19,9h-4V3H9v6H5l7,7L19,9z M5,18v2h14v-2H5z"/>
                    </svg>
                </button>
                <button class="btn-close-icon" onclick="closeEditor()">&times;</button>
            </div>
          </div>
          
          <div class="form-group">
            <label class="form-label">Nama Kontak</label>
            <input type="text" class="form-input" id="inpName" placeholder="Nama...">
          </div>
          
          <div class="form-group">
            <label class="form-label">Pesan Terakhir</label>
            <input type="text" class="form-input" id="inpMsg" placeholder="Pesan...">
          </div>

          <div class="row">
            <div class="form-group" style="flex:1">
              <label class="form-label">Waktu</label>
              <input type="text" class="form-input" id="inpTime" placeholder="12:00">
            </div>
            <div class="form-group" style="width:80px">
              <label class="form-label">Unread</label>
              <input type="number" class="form-input" id="inpUnread" value="0">
            </div>
          </div>

          <div class="form-group">
            <label class="form-label">Foto Profil</label>
            <div class="avatar-selector">
                <div class="avatar-preview-small" id="avatarPrev">A</div>
                <div style="flex:1">
                    <input type="text" class="form-input" id="inpAvatarText" placeholder="Ketik Inisial" style="margin-bottom:6px; font-size:13px; padding:8px;">
                    <label class="file-btn">
                        + Upload Foto
                        <input type="file" id="inpAvatarFile" accept="image/*" style="display:none">
                    </label>
                </div>
            </div>
            <input type="hidden" id="currentImageBase64">
          </div>

          <div class="modal-actions">
            <button class="btn btn-danger" id="btnDelete" onclick="tryDelete()">Hapus</button>
            <button class="btn btn-primary" onclick="saveChat()">Simpan</button>
          </div>
        </div>
      </div>

      <!-- CUSTOM CONFIRM MODAL -->
      <div class="confirm-overlay" id="confirmModal">
        <div class="confirm-box">
          <div class="confirm-text" id="confirmText">Konfirmasi?</div>
          <div class="confirm-buttons">
            <button class="c-btn c-btn-cancel" onclick="closeConfirm()">Batal</button>
            <button class="c-btn c-btn-ok" id="confirmOkBtn">Ya</button>
          </div>
        </div>
      </div>

      <!-- TOAST NOTIFICATION -->
      <div class="toast" id="toast">Notifikasi</div>
      
  </div> <!-- End #main-app -->

  <script>
    /* --- PALET WARNA AVATAR --- */
    const avatarColors = [
        '#00A884', '#FF5252', '#FF9800', '#3F51B5', '#2196F3', 
        '#9C27B0', '#00BCD4', '#4CAF50', '#795548', '#607D8B', '#E91E63'
    ];

    function getRandomColor() {
        return avatarColors[Math.floor(Math.random() * avatarColors.length)];
    }

    /* --- DATA --- */
    let chats = [
      {name:'Zahra', msg:'Ardi temenin aku dong di kost', time:'20.41', unread:13, avatar:'Z', isImage: false, color: getRandomColor()},
      {name:'Putri', msg:'Ardi ketemu yuk kita jalan bareng', time:'20.41', unread:1, avatar:'P', isImage: false, color: getRandomColor()},
      {name:'Nabila', msg:'Ardi Call yuk kangen banget', time:'20.25', unread:1, avatar:'N', isImage: false, color: getRandomColor()},
    ];
    let editIdx = -1;
    let tempDraftColor = '';

    /* --- ELEMENTS --- */
    const listEl = document.getElementById('chatList');
    const modal = document.getElementById('editorModal');
    const modalTitle = document.getElementById('modalTitle');
    const inpName = document.getElementById('inpName');
    const inpMsg = document.getElementById('inpMsg');
    const inpTime = document.getElementById('inpTime');
    const inpUnread = document.getElementById('inpUnread');
    const inpAvatarText = document.getElementById('inpAvatarText');
    const inpAvatarFile = document.getElementById('inpAvatarFile');
    const avatarPrev = document.getElementById('avatarPrev');
    const hiddenBase64 = document.getElementById('currentImageBase64');
    const btnDelete = document.getElementById('btnDelete');
    const confirmModal = document.getElementById('confirmModal');
    const confirmTextEl = document.getElementById('confirmText');
    const confirmOkBtn = document.getElementById('confirmOkBtn');
    const toastEl = document.getElementById('toast');

    /* --- RENDER FUNCTION --- */
    function render() {
      listEl.innerHTML = '';
      chats.forEach((c, idx) => {
        const el = document.createElement('div');
        el.className = 'item';
        el.onclick = () => openEditor(idx);

        let avatarContent = c.avatar;
        if(!c.color) c.color = getRandomColor();

        if(c.isImage) {
            avatarContent = `<img src="${c.avatar}" alt="img">`;
        }

        el.innerHTML = `
          <div class="avatar" style="background-color: ${c.color}">
            ${avatarContent}
          </div>
          <div class="meta">
            <div class="top-row">
                <div class="name">${c.name}</div>
                <div class="time">${c.time}</div>
            </div>
            <div class="bot-row">
                <div class="preview">${c.msg || ''}</div>
                ${c.unread > 0 ? `<div class="badge">${c.unread}</div>` : ''}
            </div>
          </div>
        `;
        listEl.appendChild(el);
      });
    }

    /* --- EDITOR LOGIC --- */
    function openEditor(idx = -1) {
      editIdx = idx;
      inpAvatarFile.value = '';
      
      if(idx === -1) {
        modalTitle.innerText = "Chat Baru";
        inpName.value = "";
        inpMsg.value = "";
        
        const now = new Date();
        const hours = String(now.getHours()).padStart(2, '0');
        const minutes = String(now.getMinutes()).padStart(2, '0');
        inpTime.value = `${hours}:${minutes}`;
        
        inpUnread.value = 1;
        inpAvatarText.value = "";
        hiddenBase64.value = "";
        btnDelete.style.display = "none";
        tempDraftColor = getRandomColor();
        updateAvatarPreview('?', false, tempDraftColor);
      } else {
        const c = chats[idx];
        modalTitle.innerText = "Edit Chat";
        inpName.value = c.name;
        inpMsg.value = c.msg;
        inpTime.value = c.time;
        inpUnread.value = c.unread;
        btnDelete.style.display = "block";
        tempDraftColor = c.color;

        if(c.isImage) {
            hiddenBase64.value = c.avatar;
            inpAvatarText.value = "";
            updateAvatarPreview(c.avatar, true, tempDraftColor);
        } else {
            hiddenBase64.value = "";
            inpAvatarText.value = c.avatar;
            updateAvatarPreview(c.avatar, false, tempDraftColor);
        }
      }
      modal.classList.add('open');
    }

    function closeEditor() {
      modal.classList.remove('open');
    }

    /* --- AVATAR HANDLING --- */
    inpAvatarText.addEventListener('input', (e) => {
        if(e.target.value) {
            hiddenBase64.value = "";
            updateAvatarPreview(e.target.value, false, tempDraftColor);
        }
    });

    inpAvatarFile.addEventListener('change', function() {
        if (this.files && this.files[0]) {
            const reader = new FileReader();
            reader.onload = function (e) {
                hiddenBase64.value = e.target.result; 
                inpAvatarText.value = "";
                updateAvatarPreview(e.target.result, true, tempDraftColor);
            }
            reader.readAsDataURL(this.files[0]);
        }
    });

    function updateAvatarPreview(val, isImg, bgColor) {
        avatarPrev.style.backgroundColor = bgColor;
        if(isImg) {
            avatarPrev.innerHTML = `<img src="${val}" style="width:100%;height:100%;object-fit:cover">`;
        } else {
            avatarPrev.innerHTML = val.substring(0,2).toUpperCase();
        }
    }

    /* --- SAVE & DELETE --- */
    function saveChat() {
        const name = inpName.value || "Tanpa Nama";
        let finalAvatar = "A";
        let isImage = false;

        if(hiddenBase64.value) {
            finalAvatar = hiddenBase64.value;
            isImage = true;
        } else {
            finalAvatar = inpAvatarText.value.substring(0,2).toUpperCase() || name.charAt(0).toUpperCase();
        }

        const newObj = {
            name: name,
            msg: inpMsg.value,
            time: inpTime.value,
            unread: parseInt(inpUnread.value) || 0,
            avatar: finalAvatar,
            isImage: isImage,
            color: tempDraftColor
        };

        if(editIdx === -1) {
            chats.unshift(newObj);
        } else {
            chats[editIdx] = newObj;
        }

        render();
        closeEditor();
        showToast("Chat disimpan");
    }

    function tryDelete() {
        closeEditor();
        setTimeout(() => {
             showConfirm(() => {
                if(editIdx > -1) {
                    chats.splice(editIdx, 1);
                    render();
                    showToast("Chat dihapus");
                }
            }, "Hapus chat ini?");
        }, 200);
    }

    /* --- CONFIRM & TOAST --- */
    let onConfirmAction = null;

    function showConfirm(action, message) {
        onConfirmAction = action;
        confirmTextEl.innerText = message || "Konfirmasi?";
        confirmOkBtn.innerText = message && message.includes("Hapus") ? "Hapus" : "Ya";
        confirmModal.classList.add('show');
    }

    function closeConfirm() {
        confirmModal.classList.remove('show');
        onConfirmAction = null;
    }

    confirmOkBtn.onclick = () => {
        if(onConfirmAction) onConfirmAction();
        closeConfirm();
    }

    let toastTimeout;
    function showToast(msg) {
        toastEl.innerText = msg;
        toastEl.classList.add('show');
        clearTimeout(toastTimeout);
        toastTimeout = setTimeout(() => {
            toastEl.classList.remove('show');
        }, 3000);
    }

    /* --- SCREENSHOT LOGIC --- */
    
    function downloadFromModal() {
        closeEditor();
        setTimeout(() => {
             showConfirm(processScreenshot, "Simpan tampilan daftar chat?");
        }, 350);
    }

    function processScreenshot() {
        const loading = document.getElementById('loadingOverlay');
        const appEl = document.getElementById('main-app'); // TARGET ELEMENT BARU
        
        loading.classList.add('show');
        window.scrollTo(0,0);

        // 1. Aktifkan Mode Screenshot (Ubah Fixed jadi Absolute)
        appEl.classList.add('screenshot-mode');

        setTimeout(() => {
            html2canvas(appEl, {
                useCORS: true, 
                allowTaint: true,
                scale: 2, // Kualitas HD
                backgroundColor: '#0b141a', // Warna Background WA
                // Pastikan capture sesuai ukuran container, bukan window browser
                width: appEl.offsetWidth, 
                height: appEl.scrollHeight, // Capture Full Height (Long Screenshot)
                windowWidth: 480, // Paksa rendering mode mobile
                ignoreElements: (element) => {
                    return element.id === 'loadingOverlay' || element.classList.contains('modal-overlay');
                }
            }).then(canvas => {
                // 2. Kembalikan Mode Normal
                appEl.classList.remove('screenshot-mode');
                
                const link = document.createElement('a');
                link.download = 'WA-Chat-' + Date.now() + '.png';
                link.href = canvas.toDataURL("image/png");
                link.click();

                loading.classList.remove('show');
                showToast("Screenshot berhasil disimpan!");
            }).catch(err => {
                appEl.classList.remove('screenshot-mode');
                console.error(err);
                loading.classList.remove('show');
                showToast("Gagal membuat screenshot");
            });
        }, 800); // Delay sedikit lebih lama untuk layout reflow
    }

    // INIT
    render();
  </script>

</body>
</html>
